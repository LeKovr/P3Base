P3Base
======

Base example for P3 application


# Базовый пример приложения на платформе P3 (Postgresql+Perl+Plack)

## Описание

Данное приложение реализует базовый функционал сайта с авторизацией пользователей,
который включает

* главную страницу 
* страницу регистрации пользователя
* страницу авторизации
* страницу "Кабинет", доступную только авторизованному пользователю
* страницу (ссылку) завершения сессии

Общая идея решения состоит в том, что весь функционал оформляется в виде списка методов, доступных
как внутри шаблонов tt2, через вызов api(method), так и на стороне клиента, через вызов по 
протоколу JSON-RPC

Прикладная часть размещена в файлах:

* sql/*.sql   - код для БД
* tmpl/*.html - шаблоны страниц
* lib/App.pm  - код интеграции функционала в фрейворк Plack
* t/app.t     - тест RPC методов
* app.conf    - настройки приложения

Все остальные файлы являются вспомогательными и не связаны с задачами приложения непосредственно.

## Установка

### Зависимости

* Postgresql (решение тестировалось на версии 9.1.9)
* Библиотеки perl
** DBD::Pg
** JSON
** Config::General
** Plack
** Plack::Middleware::Session
** Plack::Middleware::TemplateToolkit
** JSON::RPC::Dispatcher
** LWP::UserAgent (для тестов)
** Test::Simple  (для тестов)

### Файлы конфигурации

* app.conf
* sql/config.sql

### БД

Хранимый код использует plpgsql, поэтому он должен быть установлен в БД.
Сделать его доступным для всех новых БД:

  su postgres -c "createlang plpgsql template1"

Для установки БД надо сделать текущим каталог sql и под пользователем 
с правами создания БД и ролей postgresql выполнить make.psql, например:

  cd sql
  su postgres -c "psql -f make.psql"

### Запуск

Запуск сервера осуществляется стандартным для Plack способом, например

plackup -s Standalone --host 127.0.0.1 --port 9091 --timeout 120

см. скрипт start.sh

Если сервер запущен с указанными параметрами, возможно тестирование RPC-функционала:

perl t/rpc.t

и функционала приложения:

perl t/app.t

## Copyright

Copyright 2013, Alexey Kovrizhkin